<link rel="stylesheet" type="text/css" href="/stylesheets/searchbar.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/messages.css">

<aside class="aside">
    <!-- START Sidebar (left)-->
    <div class="aside-inner">
        <nav data-sidebar-anyclick-close="" class="sidebar">
            <!-- START sidebar nav-->
            <ul class="nav">
                <!-- Iterates over all sidebar items-->
                <li class="nav-heading ">
                    <span>My Courses</span>
                </li>
                {{#each courses}}
                    <li>
                        <a href="/class?cid={{id}}">
                            <em class="fa fa-book"></em>
                            <span>{{course_title}}</span>
                        </a>
                    </li>
                {{/each}}
            </ul>
            <!-- END sidebar nav-->
        </nav>
    </div>
    <!-- END Sidebar (left)-->
</aside>
<!-- Main section-->
<section>
    <!-- Page content-->
    <div class="content-wrapper">
        <h3>My Conversations
            <small>Talk to your classmates</small>
        </h3>
        <!-- START row-->
        <div class="calendar-app">
            <div class="row">
                <div class="col-lg-3 col-md-4">
                    <div class="row">
                        <div class="col-md-12 col-sm-6 col-xs-12 co-xs-pull-12">
                            <!-- START panel-->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">Classmates</h4>
                                </div>
                                <div class="panel-body">
                                    <div id="sender_info"
                                         data-user-id={{sender.id}} data-fname={{sender.fname}} data-lname={{sender.lname}}></div>

                                    <div class="conversations">
                                        <ul id="conv_list" style="list-style-type: none; padding-left: 6px">
                                            {{#each conversations}}
                                                <li class="conversation" id={{id}}>{{fname}} {{lname}}</li>
                                            {{/each}}
                                        </ul>
                                    </div>

                                    <button id="new_conversation" class="mb-sm btn btn-info" style="width: 100%">New Conversation</button>

                                    <div id="friend_search_content">
                                        <div id="friend_search_error"></div>
                                        <form>
                                            <input id="friend_search_bar" type="text" placeholder="Type a friend's name" class="form-control">
                                        </form>

                                        <ul id="friend_search_results" style="list-style-type: none"></ul>
                                    </div>
                                </div>
                            </div>
                            <!-- END panel-->
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-8">
                    <!-- START panel-->
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div id="message_list_error_bar"></div>

                            <ul id="message_list" style="height: 300px; overflow-y: scroll !important; list-style-type: none; padding-left: 6px"></ul>
                            <div id="report" class="modal fade" role="dialog" data-backdrop="false">
                                <div class="modal-dialog" >

                                    <!-- Modal content-->
                                    <div class="modal-content" >
                                        <center>
                                            <div style="text-align: right;">
                                                <a id="modal_close" data-dismiss="modal" href="#">close <b>X</b></a>
                                            </div>
                                            <p>To report content, complete the form below.</p>
                                            <form id="modal_feedback" method="post" action="/reportcontent">
                                                <label>Report Message:</label><p id = "message_content"></p>
                                                <p>
                                                    <label><strong>Explanation:</strong></label>
                                                    <input type="text" autofocus required size="36" name="explanation"></p>
                                                <input id="from_user_report" type="hidden" name="reported_user">
                                                <input id="message_report" type="hidden" name="reported_message">
                                                <input id="course_id_reported" type="hidden" name="course_id">
                                                <input type="submit" name="feedbackForm">
                                            </form>
                                        </center>
                                    </div>
                                </div>
                            </div>

                            <form id="send_message">
                                <div class="input-group">
                                    <label for="message" class="sr-only">Message</label>
                                    <input id="message" type="text" placeholder="Enter a message" class="form-control">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default">Send</button>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- END panel-->
                </div>
            </div>
            <!-- END row-->
        </div>
    </div>
</section>
<!-- Page footer-->
<footer>
    <span>Copyright &copy; 2015 Classwire</span>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/private_messaging.js"></script>
<script src="/js/searchbar.js"></script>

<script>
    $(window).load(function(){
        var calendar = $('#calendar');
        var events = JSON.parse('{{{calendar}}}');

        events.forEach(function(event) {
            var eventDate = Date.parse(event.calendar_date);

            var calendarEvent = {
                title: event.title,
                description: event.course_number + ': ' + event.description,
                start: eventDate,
                backgroundColor: '#00c0ef', //Info (aqua)
                borderColor: '#00c0ef' //Info (aqua)
            };

            $('#calendar').fullCalendar('renderEvent', calendarEvent, true);
        });
    });
</script>
